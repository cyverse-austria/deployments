---
- name: create the concourse user
  become: true
  ansible.builtin.user:
    name: "{{ concourse_user }}"
    password: "{{ concourse_user_password }}"
    shell: "{{ concourse_user_shell }}"
    state: present

- name: check for the concourse command
  stat:
    path: "{{ (concourse_install_dir, 'concourse/bin/concourse') | path_join }}"
  register: concourse_installed

- name:
  debug:
    msg: "{{concourse_archive_url}}"

- name: download and uncompress tarball
  become: true
  when: not concourse_installed.stat.exists
  ansible.builtin.unarchive:
    src: "{{ concourse_archive_url }}"
    dest: "{{ concourse_install_dir }}"
    remote_src: yes
    creates: "{{ (concourse_install_dir, 'concourse/bin/concourse') | path_join }}"
